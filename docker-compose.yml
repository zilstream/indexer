version: '3.8'

services:
  indexer:
    image: zilstream-indexer:latest
    build: .
    platform: linux/amd64
    container_name: zilstream-indexer
    environment:
      # Use host DB instead of a containerized one
      INDEXER_DATABASE_HOST: host.docker.internal
    volumes:
      - ./config.yaml:/app/config.yaml:ro
      - ./manifests:/app/manifests:ro
    ports:
      - "9090:9090"  # health + status (indexer only)
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped
